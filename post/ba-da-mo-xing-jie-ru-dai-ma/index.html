<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>把大模型接入代码 | zzzz&#39;s blog</title>
<meta name="description" content="有志者，事竟成">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="shortcut icon" href="https://zzzz-1111.github.io/favicon.ico?v=1764650264945">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/papercss@1.6.1/dist/paper.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://zzzz-1111.github.io/styles/main.css">


<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />


  </head>
  <body>
  
    <nav class="navbar border fixed split-nav">
  <div class="nav-brand">
    <h3><a href="https://zzzz-1111.github.io">zzzz&#39;s blog</a></h3>
  </div>
  <div class="collapsible">
    <input id="collapsible1" type="checkbox" name="collapsible1">
    <button>
      <label for="collapsible1">
        <div class="bar1"></div>
        <div class="bar2"></div>
        <div class="bar3"></div>
      </label>
    </button>
    <div class="collapsible-body">
      <ul class="inline">
        
          <li>
            
              <a href="/" class="menu">
                首页
              </a>
            
          </li>
        
          <li>
            
              <a href="/archives" class="menu">
                归档
              </a>
            
          </li>
        
          <li>
            
              <a href="/tags" class="menu">
                标签
              </a>
            
          </li>
        
          <li>
            
              <a href="/post/about" class="menu">
                关于
              </a>
            
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div id="top" class="row site">
      <div class="sm-12 md-8 col">
        <div class="paper">
          <article class="article">
            <h1>把大模型接入代码</h1>
            <p class="article-meta">
              2025-11-25
              
            </p>
            
            <div class="post-content" v-pre>
              <h2 id="api-密钥">api 密钥</h2>
<p>登录相对应的提供ai模型接口的网站，并生成自己的api 密钥</p>
<p>我使用的是硅基流动<br>
<img src="https://zzzz-1111.github.io/post-images/1764039339204.png" alt="" loading="lazy"></p>
<p>为了安全，我们一般不把密钥直接明文写在代码里，而是放在另一个文件里，然后在代码中读取文件里的密钥。</p>
<h2 id="openai库">openai库</h2>
<p>openai库是由openai提供的和ai大模型交互的一套工具，而因为openai的广泛影响力，大多数模型都支持这个库的调用。</p>
<p>安装：<code>pip install openai</code></p>
<h2 id="编写代码">编写代码</h2>
<p><strong>目标</strong>：使用python编写程序可以直接调用大模型接口</p>
<p><strong>读取key</strong></p>
<p>使用新版本的pathlib库（更加简洁）</p>
<pre><code class="language-python">    from pathlib import Path
    key = Path(&quot;key.txt&quot;).read_text().strip()
</code></pre>
<h3 id="连接大模型">连接大模型</h3>
<p><strong>创建client</strong>，创建一个对象用于和大模型的交互。</p>
<pre><code class="language-python">client = OpenAI(api_key=key, 
                base_url=&quot;https://api.siliconflow.cn/v1&quot;)
</code></pre>
<p>base_rul可能需要查询对应网站的文档得到</p>
<p><strong>发送请求</strong></p>
<pre><code class="language-python">response = client.chat.completions.create(
    model=&quot;Qwen/Qwen2.5-72B-Instruct&quot;,  # 模型的名称
    messages=[                                              # 发送给模型的信息
        {'role': 'user', 
        'content': &quot;当前有什么大模型&quot;}
    ],
    stream=True                                            # 是否是流式输出
)
</code></pre>
<h3 id="参数详解">参数详解</h3>
<ul>
<li>model表示使用的模型名称，模型名称一般可以在官网上找到全名</li>
<li>messages包含发送给模型的文字内容，既有这次的用户提问，也有以往的上下文信息</li>
</ul>
<blockquote>
<p>使用api调用的时候，模型默认是没有上下文的，我们必须每次把上下文一起传过去（所以也会消耗很多tokens）<br>
messages参数：</p>
<ol>
<li>role，有三种取值&quot;system&quot;, &quot;user&quot;, &quot;assistant&quot;<br>
system是系统提示词，并且只能位于开头，<br>
user是用户提问，assistant是模型回答<br>
stream表示是否是流式响应</li>
<li>content，是对应的文本内容</li>
</ol>
</blockquote>
<blockquote>
<p>stream：示是否启用流式输出<br>
max_tokens：生成的最大token数<br>
temperature：控制输出的随机性，范围是（0~2），数字越大越随机<br>
top_p：核采样参数，控制生成词汇的多样性，范围0-1。<br>
frequency_penalty：频率惩罚，降低重复输出相同内容的可能性，范围-2.0-2.0。</p>
</blockquote>
<h3 id="流式响应和非流式响应">流式响应和非流式响应</h3>
<p><strong>非流式响应</strong>：当请求中未设置stream参数，或者stream参数设置成False时，会受到一个完整的响应对象。</p>
<ul>
<li>object 字段固定为 &quot;chat.completion&quot;</li>
<li>在 choices 数组中，生成的消息内容位于 message 对象里，例如 <code>choices[0].message.content</code></li>
<li>返回的是一个生成器，每次迭代返回一个 ChatCompletionChunk 对象</li>
</ul>
<pre><code class="language-python">for chunk in response:
    print(chunk)
</code></pre>
<p><strong>非流式响应</strong>：当请求中设置 stream=True 时，会收到一系列数据块（chunks）</p>
<ul>
<li>object 字段固定为 &quot;chat.completion.chunk&quot;</li>
<li>在 choices 数组中，内容是增量到达的，位于 delta 对象里，例如 <code>choices[0].delta.content</code></li>
<li>最后一个数据块的 finish_reason 会指明停止原因，且 delta 对象为空。如果设置了 <code>stream_options: {&quot;include_usage&quot;: true}</code>，最后一个数据块还会包含 usage 信息</li>
</ul>
<h3 id="读取返回值">读取返回值</h3>
<pre><code class="language-python"># 方式1：流式输出
for chunk in response:  ## 遍历传过来的chunk块
    if not chunk.choices:
        continue
    if chunk.choices[0].delta.content: // choices一般只有一个choices[0],从delta中读取内容块
        print(chunk.choices[0].delta.content, end=&quot;&quot;, flush=True) // flush表示立即刷新
    if chunk.choices[0].delta.reasoning_content:  // 只有推理模型有reasoning_content
        print(chunk.choices[0].delta.reasoning_content, end=&quot;&quot;, flush=True)

# 方式2：非流式输出
if response.choices and response.choices[0].message.content: # 返回的是只有一个对象
    content = response.choices[0].message.content
</code></pre>
<p><strong>返回参数</strong><br>
response是返回的对象，具有一系列的参数</p>
<table>
<thead>
<tr>
<th style="text-align:center">参数名</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">id</td>
<td style="text-align:center">string</td>
<td style="text-align:center">本次完成的唯一标识符。</td>
</tr>
<tr>
<td style="text-align:center">choices</td>
<td style="text-align:center">array</td>
<td style="text-align:center">模型生成的完成选项列表，通常包含一个元素。</td>
</tr>
<tr>
<td style="text-align:center">created</td>
<td style="text-align:center">integer</td>
<td style="text-align:center">创建完成时的Unix时间戳（以秒为单位）。</td>
</tr>
<tr>
<td style="text-align:center">model</td>
<td style="text-align:center">string</td>
<td style="text-align:center">用于完成任务的模型名称。</td>
</tr>
<tr>
<td style="text-align:center">object</td>
<td style="text-align:center">string</td>
<td style="text-align:center">对象类型，用于区分流式与非流式响应。</td>
</tr>
<tr>
<td style="text-align:center">system_fingerprint</td>
<td style="text-align:center">string</td>
<td style="text-align:center">表示模型运行时的后端配置指纹。</td>
</tr>
<tr>
<td style="text-align:center">usage</td>
<td style="text-align:center">object</td>
<td style="text-align:center">本次请求的token使用统计信息。</td>
</tr>
</tbody>
</table>
<blockquote>
<p>choices 数组中的字段：<br>
finish_reason (string): 模型停止生成的原因。常见值包括：&quot;stop&quot;（遇到自然停止点）、&quot;length&quot;（达到最大token数）、&quot;content_filter&quot;（内容被过滤）以及 &quot;tool_calls&quot;（模型决定调用函数）。<br>
message / delta: 如前所述，非流式响应使用 message 对象存放完整消息，而流式响应使用 delta 对象存放内容片段。<br>
如果请求中定义了 tools（函数），并且模型决定调用，那么调用的详细信息（如函数名和参数）会通过 tool_calls 返回。</p>
</blockquote>
<blockquote>
<p>usage 对象：<br>
这个对象提供了本次API请求消耗资源的详细信息，对于成本监控和优化非常有用。<br>
prompt_tokens (integer): 输入提示（prompt）消耗的token数量。<br>
completion_tokens (integer): 生成的回复消耗的token数量。<br>
total_tokens (integer): 本次请求使用的token总数（prompt_tokens + completion_tokens）</p>
</blockquote>
<h2 id="如何上传图片给ai">如何上传图片给ai</h2>
<p>在传的messages的content列表里面，加入image_url类型的内容，类似于：</p>
<pre><code class="language-python">response = client.chat.completions.create(
    model=&quot;gpt-4o&quot;,  # 确保使用支持视觉的模型
    messages=[
        {
            &quot;role&quot;: &quot;user&quot;,
            &quot;content&quot;: [
                {&quot;type&quot;: &quot;text&quot;, &quot;text&quot;: &quot;请描述这张图片中的内容。&quot;},
                {
                    &quot;type&quot;: &quot;image_url&quot;,
                    &quot;image_url&quot;: {
                        &quot;url&quot;: data_url  # 这里替换为你的图片URL或Base64数据URL
                    }
                }
            ]
        }
    ],
    max_tokens=300  # 务必设置 max_tokens
)
</code></pre>

            </div>
          </article>
        </div>
        <div class="paper" data-aos="fade-in">
          
            <div class="next-post">
              <div class="next">
                Next Blog
              </div>
              <a href="https://zzzz-1111.github.io/post/shen-du-xue-xi-xue-xi-bi-ji-logistic-hui-gui-sun-shi-han-shu-yu-ti-du-xia-jiang-fa/">
                <h3 class="post-title">
                  深度学习学习笔记：Logistic回归、损失函数与梯度下降法
                </h3>
              </a>
            </div>
          
        </div>
        
      </div>

      <div class="sm-12 md-4 col sidebar">
  <div class="paper info-container">
    <img src="https://zzzz-1111.github.io/images/avatar.png?v=1764650264945" class="no-responsive avatar">
    <div class="text-muted">有志者，事竟成</div>
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      The Latest Blog
    </div>
    <div class="row">
      <ul>
        
          
            <li>
              <a href="https://zzzz-1111.github.io/post/ti-jie-p4137rmq-problem-mex/">题解 P4137【Rmq Problem / mex】</a>
            </li>
          
        
          
            <li>
              <a href="https://zzzz-1111.github.io/post/a/">Jupyter Lab和Pytorch的安装和使用</a>
            </li>
          
        
          
            <li>
              <a href="https://zzzz-1111.github.io/post/diffision-xue-xi/">diffusion学习</a>
            </li>
          
        
          
            <li>
              <a href="https://zzzz-1111.github.io/post/ba-da-mo-xing-jie-ru-dai-ma/">把大模型接入代码</a>
            </li>
          
        
          
            <li>
              <a href="https://zzzz-1111.github.io/post/shen-du-xue-xi-xue-xi-bi-ji-logistic-hui-gui-sun-shi-han-shu-yu-ti-du-xia-jiang-fa/">深度学习学习笔记：Logistic回归、损失函数与梯度下降法</a>
            </li>
          
        
          
            <li>
              <a href="https://zzzz-1111.github.io/post/ru-he-jiang-win11-you-jian-cai-dan-gai-hui-win10-chuan-tong-ban-ben/">如何将win11右键菜单改回win10传统版本</a>
            </li>
          
        
          
            <li>
              <a href="https://zzzz-1111.github.io/post/s/">blog第一天——如何使用Gridea搭建博客</a>
            </li>
          
        
          
            <li>
              <a href="https://zzzz-1111.github.io/post/hello-gridea/">Hello Gridea</a>
            </li>
          
        
      </ul>
    </div>
  </div>
  <div class="paper">
    <div class="sidebar-title">
      Label List
    </div>
    <div class="row">
      
        <a href="https://zzzz-1111.github.io/tag/t5Or_IrbPC/" class="badge warning">
          题解
        </a>
      
        <a href="https://zzzz-1111.github.io/tag/uJ89BdBJly/" class="badge secondary">
          AI
        </a>
      
    </div>
  </div>
  <div class="paper">
    Edited by Jinjia Zhao | <a class="rss" href="https://zzzz-1111.github.io/atom.xml" target="_blank">RSS</a>
  </div>
</div>


    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

</script>




  </body>
</html>
